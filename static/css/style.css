/* --- Import Google Fonts --- */
@import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap');

/* --- Theme Colors: Refined Gold & White Palette --- */
:root {
    /* Core Palette */
    --primary-accent: #e4c06a;         /* Softer, richer gold */
    --primary-accent-darker: #c7a34d;    /* Darker gold for hover/active */
    --dark-text-contrast: #2a2a2a;    /* Very dark grey, slightly softer than black */
    --main-bg: #fdfcf7;                /* Clean, slightly warm off-white */
    --container-bg: #ffffff;           /* Pure white for cards, inputs */
    --secondary-text: #555555;         /* Darker medium grey for readability */
    --medium-neutral: #b0a99a;         /* Muted warm grey for borders/inactive */
    --light-neutral: #e5e1d7;          /* Lighter warm grey for subtle dividers */
    --output-bg: #fffefa;              /* Very pale yellow/cream for output areas */
    --white: #FFFFFF;

    /* Feedback Colors */
    --error-red: #c62828;              /* Slightly deeper red */
    --error-red-bg: #fde8e8;           /* Softer pale red */
    --success-green: #2e7d32;          /* Standard success green */
    --success-green-bg: #eaf6eb;         /* Softer pale green */

    /* Shadows */
    --shadow-sm: 0 2px 4px rgba(42, 42, 42, 0.06);
    --shadow-md: 0 4px 10px rgba(42, 42, 42, 0.08);
    --shadow-lg: 0 8px 25px rgba(42, 42, 42, 0.1);

    /* Transitions */
    --transition-fast: 0.15s ease-in-out;
    --transition-medium: 0.25s ease-in-out;

    /* Borders */
    --border-radius-sm: 4px;
    --border-radius-md: 8px;
    --border-radius-lg: 12px;

    /* Font Stacks */
    --font-sans: 'Lato', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --font-serif: 'Merriweather', Georgia, Cambria, "Times New Roman", Times, serif;
    --font-mono: 'SF Mono', Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

/* --- General Styles & Resets --- */
*, *::before, *::after {
    box-sizing: border-box;
}

body {
    font-family: var(--font-sans);
    margin: 0;
    background-color: var(--main-bg);
    color: var(--dark-text-contrast);
    line-height: 1.65; /* Slightly increased line height */
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* --- Typography --- */
/* Assume header is part of the main application content */
header {
    background-color: var(--primary-accent);
    color: var(--dark-text-contrast);
    padding: 1.2rem 2rem; /* Slightly reduced padding */
    text-align: center;
    box-shadow: var(--shadow-md);
    border-bottom: 3px solid var(--primary-accent-darker); /* Darker gold border */
    margin-bottom: 2rem; /* Add space below app header */
}

h1 { /* Main Application Title (if used) */
    font-family: var(--font-serif);
    margin: 0;
    font-size: 2.2em; /* Adjusted size */
    font-weight: 700;
    letter-spacing: 0.5px;
    color: var(--dark-text-contrast);
}

h2 { /* Section Titles */
    font-family: var(--font-serif);
    color: var(--dark-text-contrast);
    border-bottom: 2px solid var(--primary-accent);
    padding-bottom: 0.5rem;
    margin: 2rem 0 1.5rem 0; /* Standardize margins */
    font-size: 1.7em; /* Adjusted size */
    font-weight: 700;
}

h3 { /* Sub-Section Titles */
    font-family: var(--font-sans); /* Using Lato for H3 */
    color: var(--secondary-text); /* More subtle color */
    margin: 1.8rem 0 1rem 0; /* Adjusted margins */
    font-size: 1.3em;
    font-weight: 700; /* Bold Lato */
}

p {
    margin-bottom: 1rem; /* Default spacing for paragraphs */
}

a {
    color: var(--primary-accent-darker);
    text-decoration: none;
    transition: color var(--transition-fast);
}
a:hover {
    color: var(--primary-accent);
    text-decoration: underline;
}

/* --- Layout Containers --- */
.tab-container {
    max-width: 980px; /* Slightly wider */
    margin: 2rem auto;
    padding: 2rem 2.5rem; /* Adjusted padding */
    background-color: var(--container-bg);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--light-neutral);
}

/* --- Tab System --- */
.tab-buttons {
    display: flex;
    border-bottom: 1px solid var(--light-neutral); /* Thinner border */
    margin-bottom: 1.8rem; /* Adjusted margin */
    overflow-x: auto;
    padding-bottom: 0; /* No extra padding needed */
    scrollbar-width: thin; /* For Firefox */
    scrollbar-color: var(--medium-neutral) var(--main-bg); /* For Firefox */
}
.tab-buttons::-webkit-scrollbar { height: 6px; } /* For Chrome/Safari */
.tab-buttons::-webkit-scrollbar-track { background: var(--main-bg); }
.tab-buttons::-webkit-scrollbar-thumb { background-color: var(--medium-neutral); border-radius: 3px; }

.tab-button {
    font-family: var(--font-sans);
    padding: 0.8rem 1.5rem; /* Comfortable padding */
    cursor: pointer;
    border: none;
    background-color: transparent;
    font-size: 1em;
    font-weight: 700;
    color: var(--secondary-text); /* Start with secondary text */
    border-bottom: 3px solid transparent;
    margin-bottom: -1px; /* Overlap container border */
    transition: color var(--transition-medium), border-color var(--transition-medium), background-color var(--transition-fast);
    white-space: nowrap;
    flex-shrink: 0;
    position: relative; /* For focus state */
    text-align: center;
}
.tab-button:hover {
    color: var(--primary-accent-darker);
    background-color: rgba(228, 192, 106, 0.07); /* Very subtle gold tint */
}
.tab-button.active {
    color: var(--primary-accent-darker);
    border-bottom-color: var(--primary-accent);
}
.tab-button:focus-visible { /* Modern focus indicator */
    outline: 2px solid var(--primary-accent);
    outline-offset: 2px;
    border-radius: var(--border-radius-sm);
}

.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.4s ease-out forwards; } /* Add forwards */

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

/* --- Form Elements --- */
textarea,
input[type="text"],
input[type="email"], /* Add other types if used */
input[type="password"],
select {
    display: block; /* Ensure block display */
    width: 100%;
    padding: 0.8rem 1rem; /* Consistent padding */
    margin-bottom: 1rem;
    border: 1px solid var(--medium-neutral); /* Slightly darker border initially */
    border-radius: var(--border-radius-md);
    font-size: 1em;
    font-family: var(--font-sans);
    box-sizing: border-box;
    background-color: var(--container-bg);
    color: var(--dark-text-contrast);
    transition: border-color var(--transition-medium), box-shadow var(--transition-medium);
    appearance: none; /* Remove default styling */
    line-height: 1.5; /* Ensure consistent line height */
}

textarea:focus,
input[type="text"]:focus,
input[type="email"]:focus,
input[type="password"]:focus,
select:focus {
    outline: none;
    border-color: var(--primary-accent);
    box-shadow: 0 0 0 3px rgba(228, 192, 106, 0.3); /* Adjusted focus ring */
}

textarea::placeholder,
input[type="text"]::placeholder,
input[type="email"]::placeholder,
input[type="password"]::placeholder {
    color: var(--medium-neutral);
    opacity: 1;
}

textarea {
    min-height: 130px; /* Slightly taller */
    resize: vertical;
}

select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23555555'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.22a.75.75 0 011.06 0L8 8.94l2.72-2.72a.75.75 0 111.06 1.06l-3.25 3.25a.75.75 0 01-1.06 0L4.22 7.28a.75.75 0 010-1.06z' clip-rule='evenodd' /%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.8rem center;
    background-size: 1em 1em;
    padding-right: 2.8rem; /* Ensure space for arrow */
}

.controls {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}
.controls label {
     font-weight: 700;
     color: var(--secondary-text);
     font-size: 0.9em;
     margin-right: 0.5rem;
     flex-shrink: 0; /* Prevent label shrinking */
}
.controls select {
     flex-grow: 1;
     min-width: 180px;
     width: auto;
     margin-bottom: 0; /* Remove margin when inside controls */
}

/* --- Buttons --- */
button.action-button {
    display: inline-flex; /* Align icon/text */
    align-items: center;
    justify-content: center;
    gap: 0.6rem; /* Space between icon/text */
    background-color: var(--primary-accent);
    color: var(--dark-text-contrast);
    padding: 0.8rem 1.6rem; /* Adjusted padding */
    border: none;
    border-radius: var(--border-radius-md);
    cursor: pointer;
    font-size: 1em;
    font-family: var(--font-sans);
    font-weight: 700;
    line-height: 1.2; /* Adjust line height for button text */
    text-align: center;
    transition: background-color var(--transition-medium), transform var(--transition-fast), box-shadow var(--transition-fast);
    margin-top: 0.5rem;
    box-shadow: var(--shadow-sm);
}

button.action-button:hover:not(:disabled) {
    background-color: var(--primary-accent-darker);
    box-shadow: var(--shadow-md);
    transform: translateY(-1px); /* Subtle lift */
}

button.action-button:active:not(:disabled) {
    transform: translateY(0) scale(0.98); /* Combine press down */
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1); /* Inner shadow on press */
}

button.action-button:disabled {
    background-color: var(--medium-neutral);
    color: rgba(255, 255, 255, 0.8); /* White text on grey */
    cursor: not-allowed;
    opacity: 0.7;
    box-shadow: none;
    transform: none;
}

button.action-button:focus-visible {
    outline: 2px solid var(--primary-accent-darker);
    outline-offset: 2px;
}

/* --- Output Areas --- */
.output-area, .feedback-area {
    margin-top: 1.8rem; /* Adjusted margin */
    padding: 1.2rem 1.5rem;
    background-color: var(--output-bg);
    border: 1px solid var(--light-neutral); /* Use light neutral for consistency */
    border-radius: var(--border-radius-md);
    min-height: 50px;
}
.feedback-area {
    background-color: var(--container-bg); /* Keep white for contrast */
}

.output-area ul, .output-area ol {
    padding-left: 1.5rem; /* Standard list indent */
    margin-top: 0.5rem;
    margin-bottom: 0.8rem;
}
.output-area li { margin-bottom: 0.5rem; }

/* Formatted Output (e.g., markdown rendering) */
.formatted-output > *:first-child { margin-top: 0; }
.formatted-output > *:last-child { margin-bottom: 0; }
.formatted-output h3 { margin: 1em 0 0.5em 0; font-size: 1.2em; }
.formatted-output p { margin-bottom: 0.8em; }
.formatted-output ul, .formatted-output ol { margin: 0.5em 0 0.8em 1.5rem; }
.formatted-output code {
    font-family: var(--font-mono);
    background-color: var(--main-bg);
    padding: 0.1em 0.4em;
    border-radius: var(--border-radius-sm);
    font-size: 0.9em;
}
.formatted-output pre {
    background-color: var(--main-bg);
    border: 1px solid var(--light-neutral);
    border-radius: var(--border-radius-sm);
    padding: 1em;
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: 0.9em;
    margin-bottom: 1em;
}
.formatted-output pre code { background: none; padding: 0; border-radius: 0; font-size: inherit; }


#corrected-text-area {
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--light-neutral);
}
#corrected-text {
    white-space: pre-wrap;
    background-color: var(--container-bg);
    padding: 0.8em 1em;
    border-radius: var(--border-radius-sm); /* Smaller radius for code */
    border: 1px solid var(--light-neutral);
    font-family: var(--font-mono);
    font-size: 0.9em;
    line-height: 1.5;
    color: var(--dark-text-contrast);
}

#correction-feedback li {
    border-bottom: 1px dashed var(--light-neutral);
    padding: 0.8em 0; /* Vertical padding */
    margin-bottom: 0; /* Let padding handle spacing */
    list-style: none;
    padding-left: 0;
}
#correction-feedback li:last-child { border-bottom: none; }
#correction-feedback li strong {
     color: var(--primary-accent-darker); /* Darker gold label */
     font-weight: 700;
     display: inline-block;
     min-width: 80px; /* Adjusted width */
     margin-right: 8px; /* Adjusted spacing */
}


/* --- Loading & Error States --- */
.loading, .error {
    margin: 1rem 0; /* Use margin for spacing */
    padding: 0.8rem 1.2rem; /* Adjusted padding */
    border-radius: var(--border-radius-md);
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center; /* Keep centered for general messages */
    gap: 0.7em;
    font-size: 0.95em;
    border: 1px solid transparent; /* Base border */
}

.loading {
    background-color: var(--success-green-bg);
    color: var(--success-green);
    border-color: #c8e6c9; /* Softer border */
}
.error {
    background-color: var(--error-red-bg);
    color: var(--error-red);
    border-color: #ffcdd2; /* Softer border */
}

/* Icons for Loading/Error (Requires Font Awesome in HTML) */
.loading::before, .error::before {
    font-family: "Font Awesome 6 Free"; /* Ensure Font Awesome is linked */
    font-weight: 900; /* Solid style */
    font-size: 1.1em;
    line-height: 1; /* Prevent icon affecting line height */
}
.loading::before {
    content: '\f110'; /* fa-spinner */
    animation: spin 1.2s linear infinite;
    color: var(--success-green);
}
.error::before {
    content: '\f071'; /* fa-exclamation-triangle */
    color: var(--error-red);
}

/* --- Chatbot --- */
#chat-bubble {
    position: fixed;
    bottom: 25px;
    right: 25px;
    background-color: var(--primary-accent);
    color: var(--dark-text-contrast);
    width: 60px; /* Standard size */
    height: 60px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px; /* Adjusted icon size */
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    transition: background-color var(--transition-medium), transform var(--transition-fast), box-shadow var(--transition-fast);
    z-index: 999;
}
#chat-bubble:hover {
    background-color: var(--primary-accent-darker);
    transform: scale(1.05) translateY(-2px); /* Combined lift/scale */
    box-shadow: 0 8px 18px rgba(0,0,0,0.2); /* Increase shadow slightly on hover */
}

#chat-window {
    position: fixed;
    bottom: 95px; /* Position above bubble */
    right: 25px;
    width: 360px;
    max-height: calc(100vh - 120px); /* Limit height based on viewport */
    height: 520px;
    background-color: var(--container-bg);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    display: flex; /* Use flex from the start if controlled by class */
    flex-direction: column;
    overflow: hidden;
    z-index: 1000;
    border: 1px solid var(--light-neutral);
    opacity: 0; /* Start hidden for animation */
    transform: translateY(15px); /* Start slightly lower */
    visibility: hidden; /* Hide completely */
    transition: opacity var(--transition-medium), transform var(--transition-medium), visibility var(--transition-medium);
}
body.chat-open #chat-window { /* Use class on body to show/hide */
    opacity: 1;
    transform: translateY(0);
    visibility: visible;
}

#chat-header {
    background-color: var(--primary-accent);
    color: var(--dark-text-contrast);
    padding: 0.8rem 1.2rem; /* Adjusted padding */
    font-weight: 700;
    font-size: 1.05em;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    border-bottom: 1px solid var(--primary-accent-darker); /* Add subtle divider */
}
#chat-header #close-chat {
    background: none; border: none; color: inherit; font-size: 1.4rem; cursor: pointer; opacity: 0.7; transition: opacity var(--transition-fast), transform var(--transition-fast); padding: 0.2rem; line-height: 1;
}
#chat-header #close-chat:hover { opacity: 1; transform: scale(1.1); }

#chat-history {
    flex-grow: 1;
    padding: 1rem 1.2rem;
    overflow-y: auto;
    background-color: var(--main-bg);
    display: flex;
    flex-direction: column;
    gap: 0.8rem; /* Space between messages */
    scrollbar-width: thin;
    scrollbar-color: var(--medium-neutral) transparent;
}
#chat-history::-webkit-scrollbar { width: 6px; }
#chat-history::-webkit-scrollbar-thumb { background-color: var(--medium-neutral); border-radius: 3px; }
#chat-history::-webkit-scrollbar-track { background: transparent; }


.message {
    padding: 0.7rem 1.1rem; /* Adjusted padding */
    border-radius: 18px; /* Rounded bubble */
    max-width: 85%;
    word-wrap: break-word;
    line-height: 1.5;
    box-shadow: var(--shadow-sm);
    font-size: 0.95em;
}
.user-message {
    background-color: var(--primary-accent);
    color: var(--dark-text-contrast);
    border-bottom-right-radius: var(--border-radius-sm); /* Speech bubble corner */
    align-self: flex-end;
    margin-left: auto;
}
.bot-message {
    background-color: var(--output-bg); /* Use output bg for bot */
    color: var(--dark-text-contrast);
    border: 1px solid var(--light-neutral); /* Add subtle border to bot messages */
    border-bottom-left-radius: var(--border-radius-sm);
    align-self: flex-start;
    margin-right: auto;
    position: relative;
    padding-left: 38px; /* Space for icon */
}
.bot-message::before { /* Bot icon */
    font-family: "Font Awesome 6 Free"; font-weight: 900; content: '\f135'; /* fa-robot */
    position: absolute; left: 12px; top: 50%; transform: translateY(-50%); /* Center vertically */
    font-size: 1.2em; color: var(--secondary-text); opacity: 0.8;
}
.bot-message .tts-icon { /* Text-to-speech icon */
    font-size: 0.9em; margin-left: 8px; color: var(--primary-accent-darker); cursor: pointer; opacity: 0.7; transition: opacity var(--transition-fast), color var(--transition-fast); vertical-align: middle; display: inline-block; /* Ensure it takes space */
}
.bot-message .tts-icon:hover { opacity: 1; color: var(--primary-accent); }

/* Chat Status Area (inside chat window) */
#chat-status-area {
    padding: 0 0.5rem; flex-shrink: 0; background-color: var(--container-bg); border-top: 1px solid var(--light-neutral);
}
#chat-status-area .loading, #chat-status-area .error {
    font-size: 0.8em; padding: 0.4rem 0.6rem; margin: 0.3rem 0; text-align: left; justify-content: flex-start; border: none; box-shadow: none; border-radius: var(--border-radius-sm);
}
#chat-status-area .loading { background-color: var(--success-green-bg); }
#chat-status-area .error { background-color: var(--error-red-bg); }

#chat-input-area {
    display: flex; padding: 0.6rem 0.8rem; border-top: 1px solid var(--light-neutral); background-color: var(--container-bg); align-items: center; flex-shrink: 0; gap: 0.5rem;
}
#chat-input {
    flex-grow: 1; border: 1px solid var(--medium-neutral); padding: 0.6rem 0.8rem; margin: 0; border-radius: var(--border-radius-md); background-color: var(--container-bg); transition: border-color var(--transition-fast), box-shadow var(--transition-fast); resize: none; font-size: 0.95em; line-height: 1.4;
}
#chat-input:focus {
    border-color: var(--primary-accent); box-shadow: 0 0 0 2px rgba(228, 192, 106, 0.2); outline: none;
}
#chat-input-area button {
    background: none; border: none; padding: 0; font-size: 1.3rem; /* Slightly smaller icons */ cursor: pointer; color: var(--primary-accent); transition: color var(--transition-fast), background-color var(--transition-fast); border-radius: 50%; width: 38px; height: 38px; display: flex; justify-content: center; align-items: center; flex-shrink: 0;
}
#chat-input-area button:hover:not(:disabled) { color: var(--primary-accent-darker); background-color: rgba(228, 192, 106, 0.1); }
#chat-input-area button:disabled { color: var(--medium-neutral); opacity: 0.6; cursor: not-allowed; background: none; }
#mic-button.recording { color: var(--error-red); background-color: rgba(211, 47, 47, 0.1); animation: pulse 1.5s infinite ease-in-out; }

/* --- Interactive Questions --- */
.question-item { margin-bottom: 1.5rem; padding-bottom: 1rem; }
hr { border: none; border-top: 1px solid var(--light-neutral); margin: 2rem 0; }
hr.question-divider { border-top-style: dashed; }

#topic-questions-form label, #level-gen-questions-form label {
    display: block; margin-bottom: 0.6rem; cursor: pointer; padding: 0.6rem 1rem; border-radius: var(--border-radius-sm); transition: background-color var(--transition-fast); color: var(--dark-text-contrast); border: 1px solid transparent; /* Add base border */
}
#topic-questions-form label:hover, #level-gen-questions-form label:hover {
    background-color: var(--output-bg); border-color: var(--light-neutral);
}

#topic-questions-form input[type='radio'], #level-gen-questions-form input[type='radio'] {
    margin-right: 0.7em; vertical-align: middle; accent-color: var(--primary-accent); transform: scale(1.1); /* Slightly larger radio */ cursor: pointer;
}

/* Fill-in-the-blank */
#topic-questions-form input[type='text'].fill-blank, /* Add a class for targeting */
#level-gen-questions-form input[type='text'].fill-blank {
    width: auto; display: inline-block; margin: 0 0.3em; padding: 0.2em 0.4em; margin-bottom: 0; box-shadow: none; border: none; border-bottom: 1px solid var(--medium-neutral); border-radius: 0; background-color: transparent; color: var(--dark-text-contrast); font-size: 1em; line-height: 1.4; vertical-align: baseline;
}
#topic-questions-form input[type='text'].fill-blank:focus,
#level-gen-questions-form input[type='text'].fill-blank:focus {
    border-bottom-color: var(--primary-accent); box-shadow: none; outline: none; background-color: var(--output-bg);
}

.question-feedback {
    font-weight: bold; margin-left: 10px; font-size: 0.85em; padding: 0.2em 0.6em; border-radius: var(--border-radius-sm); display: inline-block; vertical-align: middle; border: 1px solid transparent;
}
.question-feedback.correct { color: var(--success-green); background-color: var(--success-green-bg); border-color: #c8e6c9; }
.question-feedback.incorrect { color: var(--error-red); background-color: var(--error-red-bg); border-color: #ffcdd2; }
.question-feedback:not(.correct):not(.incorrect) { color: var(--secondary-text); background-color: #f0f0f0; border-color: #e0e0e0; }


/* --- Animation Keyframes --- */
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(200, 40, 40, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(200, 40, 40, 0); } }
/* Removed wiggle animation for buttons */

/* --- Responsive Adjustments --- */
@media (max-width: 992px) { /* Adjusted breakpoint for larger tablets */
    .tab-container { max-width: 95%; padding: 1.8rem 2rem; }
}

@media (max-width: 768px) {
    body { font-size: 15px; }
    h1 { font-size: 1.9em; }
    h2 { font-size: 1.5em; }
    h3 { font-size: 1.2em; }

    .tab-container { margin: 1.5rem 1rem; padding: 1.5rem; }
    .controls { flex-direction: column; align-items: stretch; }
    .controls select, .controls input[type="text"], .controls label { width: 100%; margin-bottom: 0.8rem; margin-right: 0; flex-grow: unset; }
    .controls button.action-button { width: 100%; margin-top: 0.5rem; }
    /* Ensure specific inputs also stack */
    #vocab-helper .controls input[type="text"],
    #topic-questions-form input[type='text'].fill-blank,
    #level-gen-questions-form input[type='text'].fill-blank {
         margin-bottom: 0.8rem; /* Add margin when stacked */
         display: block; /* Ensure they take full width when stacked */
         width: 100%;
    }

    #chat-window {
        width: calc(100% - 30px); /* Slightly less than full width */
        max-width: 380px; /* Max width on mobile */
        height: clamp(400px, 70vh, 550px); /* Responsive height */
        bottom: 15px; right: 15px; left: auto; /* Keep right aligned */
        transform-origin: bottom right; /* Animate from corner */
    }
    #chat-bubble { bottom: 15px; right: 15px; width: 55px; height: 55px; font-size: 22px; }
}

@media (max-width: 480px) {
     h1 { font-size: 1.7em; }
     h2 { font-size: 1.4em; }
     h3 { font-size: 1.15em; }
     .tab-container { padding: 1.2rem 1rem; margin: 1rem 0.5rem; }
     .tab-button { padding: 0.7rem 1rem; font-size: 0.95em; }
     button.action-button { padding: 0.8rem 1.4rem; font-size: 0.95em;}
     textarea, input[type="text"], input[type="email"], input[type="password"], select { padding: 0.7rem 0.9rem; }
     #chat-window {
         height: calc(100% - 80px); /* Almost full height */
         bottom: 10px; right: 10px; left: 10px; width: auto; /* Full width minus padding */
         border-radius: var(--border-radius-md); /* Less radius on small screens */
     }
     #chat-header { padding: 0.7rem 1rem; font-size: 1em; }
     #chat-history { padding: 0.8rem 1rem; }
     .message { padding: 0.6rem 1rem; font-size: 0.9em; max-width: 90%; }
     #chat-input-area { padding: 0.5rem 0.6rem; gap: 0.3rem; }
     #chat-input { font-size: 0.9em; padding: 0.5rem 0.7rem; }
     #chat-input-area button { width: 34px; height: 34px; font-size: 1.2rem; }

     .controls { gap: 0.5rem; margin-bottom: 1rem; }
     .controls label { margin-bottom: 0.3rem; font-size: 0.9em; }
     .controls select, .controls input[type="text"] { padding: 0.7rem; margin-bottom: 0.6rem; }
     .controls button.action-button { margin-top: 0.3rem; }
}
